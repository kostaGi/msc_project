package main

// go run -tags debug v1.go

import (
	"encoding/hex"
	"fmt"
	"os"

	"github.com/hyperledger/fabric-samples/asset-transfer-basic/chaincode-go/dilithium"
)

func test_verify_true(strMode string) bool {
	dilithium.C.InitConstants(strMode)

	var i uint32
	//-------------------------------------------------------------------------------------------------------
	b, err := os.ReadFile("./data/pk.pem")
	if err != nil {
		fmt.Print(err)
	}
	str := string(b)
	data, err := hex.DecodeString(str)
	if err != nil {
		panic(err)
	}
	pk := make([]uint8, len(data))
	for i = 0; i < uint32(len(data)); i++ {
		pk[i] = data[i]
	}
	//-------------------------------------------------------------------------------------------------------
	b, err = os.ReadFile("./data/sigma.tst")
	if err != nil {
		panic(err)
	}
	str = string(b)
	data, err = hex.DecodeString(str)
	if err != nil {
		panic(err)
	}
	sigma := make([]uint8, len(data))
	for i = 0; i < uint32(len(data)); i++ {
		sigma[i] = data[i]
	}
	//-------------------------------------------------------------------------------------------------------
	b, err = os.ReadFile("./data/msg1.tst")
	if err != nil {
		fmt.Print(err)
	}
	str = string(b)
	data, err = hex.DecodeString(str)
	if err != nil {
		panic(err)
	}
	b1 := make([]uint8, len(data))
	for i = 0; i < uint32(len(data)); i++ {
		b1[i] = data[i]
	}
	//-------------------------------------------------------------------------------------------------------
	//var b1string string = "49745f69735f776f726b696e67"
	//var sigmastring string = "478205616686ebe9c645a23cf84b0628d9b52386e63219369b9945eced21da0cd020ad95a4cf263fae0c100d6db7683d42482b73d097e943ed7f39d5a49c44b608a238e52f699a71d4f283bfab6b9e4eaee67e620765e82686e86feb4cc59ef6c2cff45a41cff17322fb7caee12f7172b593d4dcd7a5256c276308f937bc6fb28b232c44c7225c0e6e4adb042268df8f2d68fb8b4c4922c85f8bef98d68259bd4ade5105fb79946397129bf6d761b9a64332b74edf6fcfb9616be359c0fe7a2ecab1089f969cfe95e458c2f255f6b8ff66d3fb4c2c9e84a2d31646f772daeb84fc10ffa23095dba6803f5ff85a9203b03abcfa7240b68d16423477fd6f1cee006a806fe2bab66b8b72d0c0eca91e0f47a6d9df72a3e51f9593c919bf706843039db0aa71292f7b99ee79f9941e7eac9335f162f93c63c0828bec3c7baf90f3af7ba372cced15a3fcb05fa5480c615ad33b25f2bb6c8b56883446b1b4370e16a0dad03664092f4cb2944a854dd4096c8539b22dbccb5f613182996a37b711f6d81e8400cda814b071ad5076ac4a8f2e4b73dd504b6d18d2f498af52f212e5b3e15a58135e00b4c76d896b519209cdaffb50b77f289e0daf4d59d8b433f15b6cec23c1cd369032a7abaf49af94c5497448e98fca319921796f08e9668846faa61a85410e45748c172ba16acd9ef0346c77d050b0d9e8e229818b9d1aa7ff195d1a273aa9852007fda9eb890a7a67fdaf82686d24f39e742c3d68e4d4e3b94b47e64299f9cb06f6f3d4a2817127719758bd728fe879b898af23374068b41134d6bdee95b9de0326664a266202b462c5e302f6a4a1358f7e91100ca6d28c798d60368bfe58d7138a83577c00ec1f3ff7f13ad8a62bc0fc4e60f531e674a92d97b0f88240f98d16f6ea490c560c863443033a4b43ccb04d0d5a871009680f0ba992ac321901c480db4f12f7455e9cc7ba49123624233678338cd93452e38fa2f4b3bc7e140aa0f48aec37334c95a41365c9837fd1ce80b653e3be1e82ad60f068c1e1b129a5237109585aecdee27f42e413ba04e50755e1a68e5fa445eb614428ee499b99c88899446c9f3d8c39548d1dfd3f33b83fc9c8800394d6de724b80977c2c8efc22b49e726b4eddc0501cf1c9d8f129ceacd7c963310f36c496355125a9939cc48e5366ca68b1c4ac6962985e70dae8041e3e83fec36d77d4c376f5c270af652c1b3d6b503f7947491f8162abc0bb1017e2c0a872b4725e03215b4488c78f4af5f618b42a074796ce4b2063029ca6fb65a4270735e265bd767bff9ce024da773930a0e19e3554b619149a14d613e8e45082343b1572e2435567c15483deb88c8c282dc4835a684a999f2aabc4853e7bbe5b4b233ae46d838873f060bc66817a1b948955ac1104d0af8ca3e29a96a622cd0f3e93dd40c38371881667832e64ac91cbd654d005e0906a8a260d2f92476552f55bbae103cd6755f8326f8580c606ac8c4a071191144dc142ea6728342e12937d1e24aaec33418fd15fe9038deb00a6b479905eeef40dfb5faa4e500fe7cd42cc690edae2ed4c52ae5d12dbb1b6ac4590da5e6e46b6dc9fe292d6c2c1fe1db468384e40776a811b5af55c5dd7faf7f173eb371a0862791253aa0e7501e04653f629fe12f051d6e69da3fc0cd6a07c18b58872dafa16750395a313608a9eff23d28ca31b86c618cc1813ca224f4921c4c12b082c9a1b5c0fd862cb93490b4d29841a97891c54c58bc1543b71a3698cd7a2b788bdf9fb7a2cff18096d66fa1fc8f1c7fd76abe978da28f1c2643a5a909abab2cc7b3f8dca4bbfd88543db5e9514c4d2fd22db286b26da7c921efea498ca603c5d3794fe366cf13f2ff059ea58411bf3e774ec479813b1211b522d4b931e786039911dd9dfc2285dac7991ef57df038aba5aac758f44b982d71fd620eb58e3d965e58fda04401e071f6d4b8a1450bc7492dbe1087f84ee67934983be6514b944e983d50a71b92b97f0347d44a2bc4386cb72d37518ab3d4400d0f6d9955f5f9e7b5e218c87b926c14b981b06cec9c68ba8db15119210940c4b5b738cd4461f1024aa1328e9e6a8916e761d48d446f4e0dbf9293978d27ea03929ecc1fe2c906e9cb5824a3411f56d9ff2a8c0ecf3e18ccde963faf53e061e99a5eb13b420f0dc5f1bf56ba10d21ac2e3b22634c61de92cc2b3df53b9f51fd902cff0404aa490cbcb3369ef4fa2da513653b7b97035efc71660992e703d0e3483c1f6f9135bece03653e7ac1ea90b79d84a14397620831a95cb809c4ad14bf88de55e7a996c491e9eb4c5aed6e452caf6ecfa39ae5fd1708f350db3851d360f7d7d825806c72a716e9c1a784ca2faf05749b955f0095991069eb6da46af39f009c2746a421292086602f698f24f804d61262ea3d140cb7feccd8646f8637443e0e71189bacb940505ad8cd5038e1cd4d31531f261d316aa2c0207f3742b9c90f9a0d47478b33700875b6a137a4002bf8e3e62d25ff7e7a5b47508dcdd9eca7372f6fc39fc91ca4aa28923da744bf54cba3222cbf546f9d035df8a2711d33fa285641b5ca184b1b3e2b642ee1a572b8a7d6a7c9711a96c0df0deaad50cf82e55d0f06b5184e32753d7dd30fb7ec3ad1e9fefa53a236be015d12632715cd221aa7e5d9f85538cd54af5ced60797ac5818086c1e1324cdf807e3b7c17ca6b538ecaec7a6960e4826d166d052a4cf687d6988915873c1a54244e53f3fb1462c381b6af75458d1ca674cdab9a482a7a79beef8e12b1fabd0147e53fcf3ba6e53d19ff0d81ea791d8cf95c73024b7bb3f5540d6d5539c9eba602c46abfa337649bf12c8fc79327f7fa61f1363fff6d60457434e73b01ef6d60622878f67074b4410694f5fbf3022039d3ad2e849bfc4558d030a5b5fbab041ad427948c9dec3d701f4d4b37593e1f52add4480b35d3b8e67f7c94a28bf71af7e1f8f4f61d55dc423431d74d768dcccf561ebae514170b3dd80d454d27af146856276067ffcae48851720caf196c1c1776f704f41cd156615f3a41d5e7f0481b429dd3b47d621140106c8887b99ddf8e1d08c66848bdbff2427923e92aedcd2cf90bddef66135ccb76c2246d3ccab0472d484da6e87c2d1ceb55c34fdbefea765bbe5480d8cfb2ecfbf4d319738f48859e0be05d7d1035a58411745947978dbd83ab6e539c106464a1458378196928ad3a568e635b091ae78c676c5183fcb55c632b294bffb3e21c9a073745059fc5d4ccae3d93fdcee4e64e0663adb6c9c42ea89ba399ae9b466469dde79dd61e2e6f7a88a2b9c3c9cee4e9f2f61c3b5556576275899a9fa5c0cdd4dd04161d1e2c3a3d416b6d787f888fcdcfecedfe08090b1617181f21242b4e5051525a787a879499a4a7acbecfeaebecedf2fc000e1d304f"
	//var pkstring string = "a1ff67dfb26ecb1c4b1e3a7b0ecbbbdc7e06f733e8d529676169aec1ef2a91864556b6a4c920bf355cd8b55c9f3bfe548c3def4e31a0656c6906ef6d90ae3bfd26be06be6a749bf7a3d9377d387f39e7144b5839746163e09c0379740d0405a4778d9763bb703177239b79a731d0a77f7e8d8c8e4c18d9d5beb54d86c8ec63d7ae27314690c7e091100841d849b9541c415ceb5ed55c10f352b2f1627cf20560e25fc6e673fa7c8c3042af98a721ec3b1767d74bea3ca835b453eaf65454beb7d029963addecbd6ee1fbbadbb65d6cb503933aad5b0b73fa06e22605a12d6a3f0ee17aee48e8c6a17c4d3a2f90f8e6b66dd44996956fab25d94350de49a81cff324bd7b95b83dfe49976dcc5b491b0c2ec0ed3e0df5c268b45dffb56a23f37a38d41c24986d7e5449d91a1f749fc231f36172615ba6c1aa2bb77dbbafc74e9a96eddbeb21fc3be9c20dfa789148c120f9d3edac2e48f9dcd5a266b91367bb08f8c2797bf39c4bbcde409eb00e9a7dc2f6fd69e23c8c0d56923382716d1c0110175a0a8611375aa51d753897ecfd6e3ce8f284a6573b9a36b5cfb014315ad372c7d6d18ecfa43ef375be16f2aea1af08c6b056eed7ef0b6933445ba570fb2d4e10ba8be1f368ba49e1fe057b765af8a83bcaff27398f0c136a2866baa5f29afa4462ab1dd0328da0ba8ef003df625f508cb1d5566445886085526eaa94d38bc4cf6195d7ae82f8534c7b83a85b596d3f62c909e62a8908b9caa42af63c75f5633d2d1aa8799ccb2ba72261f61fd4b55c2c0046a787215e8c4c6125ce0bc2a00bb282df83f8d0d25883a6cf53dd2d3f58cb1cf078815cd6560cbe05f8322819d41e8bad0d5ce956b331269b74023bf3cbb1ba52208ec157d067446b8f667ccc852023796531b5b69ecefcac590ab1b6b7a88a1adafb15986b157346106415a1319597c3eae5f0d01e6fa2e6e993c81599402bf0b32d4f923b49d42876a2b07ef99dd38100c466226558e012ea92bddc6cbcaa7025df2e97a705c88dfb7f2db33ced0da26bd7cd1dd053f8423b95a42df737ae2412225f50d89743e33cb590005a3b33b8224979aadcca3135f903f1d8c0017c9e90afc90cea040377d3a1cd1b6ee0e047948040245a141da83a2307061647b19970c8d9d63638770576d152af07c97dc4915974c08777739c0be61a7f6d0d4580f1aa398e7edbbd0b4569cd558ba9a3e6477208513feb8ada0b80d6bc2a7a2305a208597f258f3f093ea8f4862f126733e9b591c609ed679dd27b8640f038b22766c145cadc9a937198fd132343c0b4dade8a0a28774cca73f8027bad25c52bdf587e58bc3b927709ee411c54ccbbc497c4dd22a27c107660e04951f36ae81f32afc581b74d2ba4bfd1c3c1f0f45f04eae4650b68e433fd509c6a03993963f270dd94ff5975107cfb8bbfdcf874250706658e280b76d792378d2790d2f1fb77780375682e0877f8333ffbd03df194a96d6ca64966a27f1f5e34a1a61c5ac79055e623b7b90b63445ec83124e73f94d49e647687f352021bb96548b5a21a901207b44ca4897c2aa9f903f1ef91f3e3708d54ce3d2e54e7023a4af6d3315b729816d8d1adb4e6cb8f0f1e5c63a0506e3f284fa2af4577311f395eda6d80ced605574d447d87e50815595a878240ef08407e9e5b3c0dae80d8642f5265a6c38cf9cb3c2138d0ca47d174f4b37b523ba43ff4ae50dd53f6dd58b02ae36c709d7dc83b575e244227ea83dc070d8b45477ebceb732d439edfed8fd50b7ee53847f526294c7a1b33cba35e39842e332ed355be0a501b5eb56ce9d612edb9b49d7b5ad005050f06d3155bc0bc06595f5c584"

	if !dilithium.Verify(pk, b1, sigma) {
		fmt.Println("Verification failed")
		return false
	}

	fmt.Println("Verification success")
	return true
}

func main() {
	test_verify_true("2py")
}
